
# [202_105] Search and replace: add "Replace all occurrences" button

## How to test
1. Open a document with multiple occurrences of a word (e.g. "hello" appearing 5 times)
2. Open search and replace (Edit â†’ Search and replace)
3. Place cursor in the middle of the document (e.g. after the 3rd occurrence)
4. Enter the search term "hello" and the replacement "world"
5. Click "Replace all further occurrences" (or press Ctrl+Enter / Command+Enter)
6. Confirm that only the occurrences **after the cursor** are replaced (original behavior preserved)
7. Undo, then click "Replace all occurrences"
8. Confirm that **all 5 occurrences** are replaced, including those before the cursor

## 2026/02/25
### What
Add a separate "Replace all occurrences" button that replaces every match in the entire document, while keeping the original "Replace all further occurrences" button and behavior.

### Why
Users expect a way to replace every occurrence in the document regardless of cursor position (issue #2857). The maintainer requested this as a separate button so the original "Replace all further occurrences" behavior is preserved.

### How
Added a new `replace-all-occurrences` function that calls `(search-extreme-match #f)` before the replace loop to navigate to the first match, so replacement starts from the beginning of the document. The original `replace-all` function is kept unchanged.

```scheme
(tm-define (replace-all-occurrences . args)
  (let ((u    (if (null? args) (master-buffer)  (car args)))
        (raux (if (null? args) (replace-buffer) (cadr args))))
    (and-with by (or (by-tree raux) current-replace)
      (with-buffer u
        (search-extreme-match #f)  ;; Go to the first match
        (start-editing)
        (while (replace-next by)
          (perform-search*))
        (end-editing))
      (perform-search*)
      (set! isreplace? #t))))
```



