# [200_48] User-Agent and Device ID
### 如何测试
点击`插入交互对话`，使用`scheme`，输入：
```
(stem-user-agent)
;;期望返回类似：LiiiSTEM-v2026.2.0-rc2 Debian_GNU/Linux_13_(trixie) x86_64
(stem-device-id)
;;期望返回类似：469709a0db73706427292c7019d41d55f64de1d965367da4206d9d952849120e
```

## 2026/02/12 http请求的请求头优化
### What
1. 场景1: 用户认证
    - 用户登录/刷新 token 时携带设备信息
    - 涉及文件: src/Plugins/Qt/QTMOAuth.cpp
      - handleAuthorizationCode(): 授权码换 token
      - refreshToken(): 刷新 access_token

2. 场景2: 获取用户信息
    - 登录成功后拉取用户详情时携带标识
    - 涉及文件: src/Plugins/Qt/qt_tm_widget.cpp
      - fetchUserInfo(): 获取用户信息 API

3. 场景3: 远程资源下载
    - 文档中 <include|https://...> 远程文件时携带标识
    - 涉及文件: src/System/Files/web_files.cpp
      - get_from_web(): HTTP 资源下载

4. 场景4: 浏览器打开链接
    - 暂不处理（外部浏览器无法控制 HTTP header）

5.  改动总结
    - 新增 3 个文件的 HTTP header 注入
    - 使用统一的 stem_user_agent() 和 stem_device_id()
    - 共新增约 10 行代码

## 2026/02/12 降低调用损耗

## 2026/02/11 添加 User-Agent and Device ID 函数

### What
提供 HTTP 请求所需的 User-Agent 和设备唯一标识符功能。
- **User-Agent**: 在 HTTP 请求头中携带客户端信息（应用版本、操作系统、架构），便于服务器识别客户端环境
  ```
  LiiiSTEM-v2026.2.1 Windows_11_10.0.26100 x86_64
  LiiiSTEM-v2026.2.1 macOS_15.3 arm64
  LiiiSTEM-v2026.2.1 Debian_GNU/Linux_13_(trixie) x86_64
  ```
- **Device ID**: 基于网卡 MAC 地址生成的设备唯一标识符，用于设备认证、防止多设备共享账户等场景

### Why
- HTTP 请求时准确标识客户端环境，便于服务端做兼容性处理
- 设备绑定和认证，防止账户在多设备上滥用
- 统一各平台的系统信息获取方式，提供更详细的版本信息（如 Windows 11 26200.7623）
